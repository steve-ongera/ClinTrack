<!-- ========================================== -->
<!-- 2. susars/susars_detail.html -->
<!-- ========================================== -->
{% extends 'base.html' %}
{% load static %}

{% block title %}{{ susar.susar_id }} - ClinTrack{% endblock %}

{% block extra_css %}
<style>
/* Reuse the same styling from study_detail.html */
body {
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Helvetica Neue', Arial, sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

h4 { font-size: 1.125rem; }
h5 { font-size: 1rem; }
p, td, li, th { font-size: 0.8125rem; }
small { font-size: 0.75rem; }

.breadcrumb {
    background: transparent;
    padding: 0;
    margin-bottom: 0;
    font-size: 0.75rem;
}

.breadcrumb-item { color: #6c757d; }
.breadcrumb-item a { color: #667eea; text-decoration: none; }
.breadcrumb-item.active { color: #495057; font-weight: 500; }

.page-header {
    padding: 1rem 0;
    margin-bottom: 1.5rem;
}

.page-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: #2a2a2a;
}

.card {
    border: none;
    border-radius: 8px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
    margin-bottom: 1.5rem;
}

.card-body { padding: 1.25rem; }

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.25rem;
    padding-bottom: 0.875rem;
    border-bottom: 1px solid #f0f0f0;
}

.card-header h4 {
    font-size: 1.125rem;
    font-weight: 600;
    color: #2a2a2a;
    margin: 0;
}

.btn {
    border-radius: 6px;
    padding: 0.5rem 1rem;
    font-size: 0.75rem;
    font-weight: 500;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
}

.btn-warning {
    background: linear-gradient(135deg, #ffab00 0%, #ff9900 100%);
    color: white;
}

.btn-warning:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(255, 171, 0, 0.2);
}

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.susar-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
    padding: 1rem;
    background: #fff5f5;
    border-radius: 8px;
    border-left: 4px solid #dc3545;
}

.susar-icon {
    width: 48px;
    height: 48px;
    border-radius: 8px;
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.25rem;
}

.susar-info { flex: 1; }

.susar-id {
    font-family: 'SF Mono', Monaco, monospace;
    font-size: 1rem;
    font-weight: 600;
    color: #dc3545;
    margin-bottom: 0.25rem;
}

.susar-description {
    font-size: 0.875rem;
    color: #495057;
    font-weight: 500;
}

.detail-row {
    display: flex;
    padding: 0.5rem 0;
    border-bottom: 1px solid #e9ecef;
}

.detail-row:last-child { border-bottom: none; }

.detail-label {
    width: 180px;
    color: #6c757d;
    font-weight: 500;
    font-size: 0.75rem;
    flex-shrink: 0;
}

.detail-value {
    flex: 1;
    color: #495057;
    font-size: 0.8125rem;
}

.detail-section {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 1.25rem;
    margin-bottom: 1.5rem;
}

.section-title {
    font-size: 0.875rem;
    font-weight: 600;
    color: #2a2a2a;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.badge {
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-weight: 500;
    font-size: 0.6875rem;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
}

.badge.mild { background: rgba(40, 199, 111, 0.1); color: #28c76f; border: 1px solid rgba(40, 199, 111, 0.2); }
.badge.moderate { background: rgba(255, 171, 0, 0.1); color: #ffab00; border: 1px solid rgba(255, 171, 0, 0.2); }
.badge.severe { background: rgba(255, 107, 0, 0.1); color: #ff6b00; border: 1px solid rgba(255, 107, 0, 0.2); }
.badge.life_threatening { background: rgba(220, 53, 69, 0.1); color: #dc3545; border: 1px solid rgba(220, 53, 69, 0.2); }
.badge.fatal { background: rgba(0, 0, 0, 0.1); color: #000; border: 1px solid rgba(0, 0, 0, 0.2); }

.status-indicator {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.375rem 0.75rem;
    border-radius: 6px;
    font-size: 0.75rem;
    font-weight: 500;
}

.status-indicator.yes {
    background: rgba(40, 199, 111, 0.1);
    color: #28c76f;
    border: 1px solid rgba(40, 199, 111, 0.2);
}

.status-indicator.no {
    background: rgba(108, 117, 125, 0.1);
    color: #6c757d;
    border: 1px solid rgba(108, 117, 125, 0.2);
}
</style>
{% endblock %}

{% block content %}
<div class="content-wrapper">
  <div class="page-header">
    <h3 class="page-title">SUSAR Details</h3>
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Dashboard</a></li>
        <li class="breadcrumb-item"><a href="{% url 'susars_list' %}">SUSARs</a></li>
        <li class="breadcrumb-item active">{{ susar.susar_id }}</li>
      </ol>
    </nav>
  </div>

  <div class="row">
    <div class="col-md-8">
      <!-- SUSAR Header -->
      <div class="card">
        <div class="card-body">
          <div class="susar-header">
            <div class="susar-icon">
              <i class="bi bi-exclamation-triangle"></i>
            </div>
            <div class="susar-info">
              <div class="susar-id">{{ susar.susar_id }}</div>
              <div class="susar-description">{{ susar.event_description|truncatechars:100 }}</div>
            </div>
            {% if user.role != 'viewer' %}
            <a href="{% url 'susars_update' susar.pk %}" class="btn btn-warning">
              <i class="bi bi-pencil"></i>
              Edit SUSAR
            </a>
            {% endif %}
          </div>

          <!-- Event Details -->
          <div class="detail-section">
            <div class="section-title">
              <i class="bi bi-info-circle"></i>
              Event Information
            </div>
            <div class="detail-row">
              <span class="detail-label">Participant:</span>
              <span class="detail-value">
                <a href="{% url 'participant_detail' susar.participant.pk %}">
                  {{ susar.participant.participant_id }} - {{ susar.participant.get_full_name }}
                </a>
              </span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Event Description:</span>
              <span class="detail-value">{{ susar.event_description }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Severity:</span>
              <span class="detail-value">
                <span class="badge {{ susar.severity }}">
                  {{ susar.get_severity_display }}
                </span>
              </span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Outcome:</span>
              <span class="detail-value">{{ susar.get_outcome_display }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Onset Date:</span>
              <span class="detail-value">{{ susar.onset_date|date:"F d, Y H:i" }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Detection Date:</span>
              <span class="detail-value">{{ susar.detection_date|date:"F d, Y H:i" }}</span>
            </div>
          </div>

          <!-- Causality Assessment -->
          <div class="detail-section">
            <div class="section-title">
              <i class="bi bi-diagram-3"></i>
              Causality Assessment
            </div>
            <div class="detail-row">
              <span class="detail-label">Related to Study:</span>
              <span class="detail-value">
                <span class="status-indicator {% if susar.is_related_to_study %}yes{% else %}no{% endif %}">
                  <i class="bi bi-{% if susar.is_related_to_study %}check-circle{% else %}x-circle{% endif %}"></i>
                  {% if susar.is_related_to_study %}Yes{% else %}No{% endif %}
                </span>
              </span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Causality Details:</span>
              <span class="detail-value">{{ susar.causality_assessment|default:"Not provided" }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Hospitalization Required:</span>
              <span class="detail-value">
                <span class="status-indicator {% if susar.hospitalization_required %}yes{% else %}no{% endif %}">
                  {% if susar.hospitalization_required %}Yes{% else %}No{% endif %}
                </span>
              </span>
            </div>
          </div>

          <!-- Actions Taken -->
          <div class="detail-section">
            <div class="section-title">
              <i class="bi bi-clipboard-check"></i>
              Actions Taken
            </div>
            <div class="detail-row">
              <span class="detail-value">{{ susar.actions_taken }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <!-- Reporting Status -->
      <div class="card">
        <div class="card-body">
          <div class="card-header">
            <h4>
              <i class="bi bi-file-earmark-text me-2"></i>
              Reporting Status
            </h4>
          </div>

          <div class="detail-section">
            <div class="detail-row">
              <span class="detail-label">Reported to IRB:</span>
              <span class="detail-value">
                <span class="status-indicator {% if susar.reported_to_irb %}yes{% else %}no{% endif %}">
                  {% if susar.reported_to_irb %}Yes{% else %}No{% endif %}
                </span>
              </span>
            </div>
            {% if susar.reported_to_irb %}
            <div class="detail-row">
              <span class="detail-label">IRB Report Date:</span>
              <span class="detail-value">{{ susar.irb_report_date|date:"M d, Y" }}</span>
            </div>
            {% endif %}
            <div class="detail-row">
              <span class="detail-label">Reported to Sponsor:</span>
              <span class="detail-value">
                <span class="status-indicator {% if susar.reported_to_sponsor %}yes{% else %}no{% endif %}">
                  {% if susar.reported_to_sponsor %}Yes{% else %}No{% endif %}
                </span>
              </span>
            </div>
            {% if susar.reported_to_sponsor %}
            <div class="detail-row">
              <span class="detail-label">Sponsor Report Date:</span>
              <span class="detail-value">{{ susar.sponsor_report_date|date:"M d, Y" }}</span>
            </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Follow-up Status -->
      <div class="card">
        <div class="card-body">
          <div class="card-header">
            <h4>
              <i class="bi bi-clipboard-check me-2"></i>
              Follow-up
            </h4>
          </div>

          <div class="detail-section">
            <div class="detail-row">
              <span class="detail-label">Follow-up Required:</span>
              <span class="detail-value">
                <span class="status-indicator {% if susar.follow_up_required %}yes{% else %}no{% endif %}">
                  {% if susar.follow_up_required %}Yes{% else %}No{% endif %}
                </span>
              </span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Follow-up Notes:</span>
              <span class="detail-value">{{ susar.follow_up_notes|default:"No notes provided" }}</span>
            </div>
          </div>

          <div class="metadata mt-3 pt-3 border-top" style="font-size: 0.6875rem; color: #6c757d;">
            <div class="mb-2">
              <i class="bi bi-person me-1"></i>
              Reported by: {{ susar.reported_by.get_full_name }}
            </div>
            <div class="mb-2">
              <i class="bi bi-clock me-1"></i>
              Created: {{ susar.created_at|date:"M d, Y H:i" }}
            </div>
            <div>
              <i class="bi bi-arrow-clockwise me-1"></i>
              Updated: {{ susar.updated_at|date:"M d, Y H:i" }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
{% endblock %}

<!-- ========================================== -->
<!-- 7. studies/study_detail.html -->
<!-- ========================================== -->
{% extends 'base.html' %}
{% load static %}

{% block title %}{{ study.code }} - ClinTrack{% endblock %}

{% block content %}
<div class="content-wrapper">
  <div class="page-header">
    <h3 class="page-title">Study Details</h3>
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Dashboard</a></li>
        <li class="breadcrumb-item"><a href="{% url 'study_list' %}">Studies</a></li>
        <li class="breadcrumb-item active">{{ study.code }}</li>
      </ol>
    </nav>
  </div>

  <div class="row">
    <div class="col-md-8">
      <div class="card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="card-title">Study Information</h4>
            {% if user.role == 'admin' %}
            <a href="{% url 'study_update' study.pk %}" class="btn btn-warning">Edit</a>
            {% endif %}
          </div>

          <table class="table table-borderless">
            <tr>
              <th width="200">Study Code:</th>
              <td>{{ study.code }}</td>
            </tr>
            <tr>
              <th>Study Name:</th>
              <td>{{ study.name }}</td>
            </tr>
            <tr>
              <th>Description:</th>
              <td>{{ study.description|default:"No description" }}</td>
            </tr>
            <tr>
              <th>Start Date:</th>
              <td>{{ study.start_date|default:"Not set" }}</td>
            </tr>
            <tr>
              <th>End Date:</th>
              <td>{{ study.end_date|default:"Not set" }}</td>
            </tr>
            <tr>
              <th>Status:</th>
              <td>
                {% if study.is_active %}
                <span class="badge badge-success">Active</span>
                {% else %}
                <span class="badge badge-secondary">Inactive</span>
                {% endif %}
              </td>
            </tr>
            <tr>
              <th>Created:</th>
              <td>{{ study.created_at|date:"Y-m-d H:i" }}</td>
            </tr>
            <tr>
              <th>Last Updated:</th>
              <td>{{ study.updated_at|date:"Y-m-d H:i" }}</td>
            </tr>
          </table>
        </div>
      </div>

      <div class="card mt-4">
        <div class="card-body">
          <h4 class="card-title">Participants</h4>
          {% if participants %}
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th>Participant ID</th>
                  <th>Name</th>
                  <th>Status</th>
                  <th>Enrollment Date</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for participant in participants %}
                <tr>
                  <td>{{ participant.participant_id }}</td>
                  <td>{{ participant.get_full_name }}</td>
                  <td><span class="badge badge-{{ participant.status }}">{{ participant.get_status_display }}</span></td>
                  <td>{{ participant.enrollment_date|default:"Not enrolled" }}</td>
                  <td>
                    <a href="{% url 'participant_detail' participant.pk %}" class="btn btn-sm btn-info">View</a>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <a href="{% url 'participant_list' %}?study={{ study.id }}" class="btn btn-sm btn-primary">View All Participants</a>
          {% else %}
          <p>No participants enrolled yet.</p>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card">
        <div class="card-body">
          <h4 class="card-title">Statistics</h4>
          <table class="table table-borderless">
            <tr>
              <th>Total Participants:</th>
              <td>{{ stats.total }}</td>
            </tr>
            <tr>
              <th>Active:</th>
              <td>{{ stats.active }}</td>
            </tr>
            <tr>
              <th>Completed:</th>
              <td>{{ stats.completed }}</td>
            </tr>
            <tr>
              <th>Screening:</th>
              <td>{{ stats.screening }}</td>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

